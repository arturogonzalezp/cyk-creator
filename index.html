<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>CYK Creator</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/css/materialize.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/js/materialize.min.js" type="text/javascript"></script>
    <style type="text/css">
        #automatacanvas {
            width: 100%;
            height: 300px;
        }

        #languageinput {
            height: 120px;
            overflow-y: auto;
            max-height: 120px;
        }

        .block-height {
            max-height: 400px;
            height: 400px;
            min-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1 class="center">CYK Creator</h1>
        <h3 class="center">César Arturo González Pérez</h3>
        <div class="row">
            <div class="col s12 m6">
                <ul class="collection with-header z-depth-2 hoverable block-height">
                    <li class="collection-header">
                        <h4 class="center">Instructions</h4>
                    </li>
                    <li class="collection-item">The symbol "->" is used to reprent the division:
                        <ul>
                            <li>Left side is the generator identifier</li>
                            <li>Right side is the generated</li>
                        </ul>
                    </li>
                    <li class="collection-item">Generators must be uppercase letters</li>
                    <li class="collection-item">Generators must be uppercase letters</li>
                    <li class="collection-item">Avoid using spaces</li>
                    <li class="collection-item">
                        <span class="title">Node colors
                            <span class="badge red white-text">Final nodes</span>
                            <span class="badge green white-text">Start node</span>
                        </span>
                    </li>
                </ul>
            </div>
            <div class="col s12 m6">
                <div class="card z-depth-2 hoverable block-height">
                    <div class="card-content">
                        <h4 class="center">Input</h4>
                        <div class="divider"></div>
                        <div class="row">
                            <div class="input-field col s12">
                                <textarea id="languageinput" class="materialize-textarea" placeholder="Input the language here">
S->ab|aAB
A->aba
B->aB|b
                                </textarea>
                                <label for="languageinput">Language</label>
                            </div>
                            <div class="input-field col s12">
                                <input type="text" id="wordinput" placeholder="abbaa" value="abbaa" />
                                <label for="wordinput">Word</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col s12 m12">
                <div class="card z-depth-2">
                    <div class="card-content">
                        <table class="centered responsive-table">
                            <tbody id="cyk-table-body">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col s12 m4">
                <div class="card z-depth-2">
                    <div class="card-content">

                    </div>
                </div>
            </div>
        </div>
        <div class="fixed-action-btn">
            <a class="btn-floating btn-large red pulse" onclick="loadText()">
                <i class="large material-icons">play_arrow</i>
            </a>
        </div>
    </div>
</body>
<script>
    var generatorsMap, word, cykLogicTable, cykVisualTable;
    function loadText() {
        generatorsMap = {};
        var input = document.getElementById("languageinput").value;
        word = document.getElementById("wordinput").value;
        cykVisualTable = document.getElementById("cyk-table-body");
        var sentences = loadSentences(input);
        sentences.forEach(function (sentence) {
            sentence = sentence.trim();
            if (sentence.includes("->")) {
                var statements = sentence.split("->");
                generatorsMap[statements[0]] = [];
                var pipelines = statements[1].split("|");
                pipelines.forEach(function (pipeline) {
                    generatorsMap[statements[0]].push(pipeline);
                });
            }
        });
        createLogicTable();
        updateVisualTable();
        console.table(generatorsMap);
        console.table(cykLogicTable);
    }
    function loadSentences(text) {
        var statements = text.split("\n");
        return statements;
    }
    function createLogicTable() {
        cykLogicTable = [];
        var charArray = Array.from(word);
        charArray.forEach(function (c, index) {
            var tempArray = new Array(charArray.length - index);
            for(var i = 0; i < tempArray.length; i++){
                tempArray[i] = "-";
            }
            cykLogicTable.push(tempArray);
        });
    }
    function updateVisualTable() {
        while (cykVisualTable.firstChild) cykVisualTable.removeChild(cykVisualTable.firstChild);
        for (var i = 0; i < word.length; i++) {
            var tds = "";
            for (var j = 0; j <= i; j++) {
                tds += "<td>" + cykLogicTable[j][word.length-i-1] + "</td>";
            }
            cykVisualTable.insertAdjacentHTML('beforeend', '<tr>' + tds + '</tr>');
        }
        var tdLetters = "";
        for (var i = 0; i < word.length; i++) {
            tdLetters += "<td>" + word[i] + "</td>";
        }
        cykVisualTable.insertAdjacentHTML('beforeend', '<tr>' + tdLetters + '</tr>');
    }
</script>

</html>